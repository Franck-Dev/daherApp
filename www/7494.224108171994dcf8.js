"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7494],{7494:(G,A,r)=>{r.r(A),r.d(A,{MoldingPageModule:()=>Q});var g=r(6019),I=r(9010),l=r(2651),m=r(430),d=r(4762),e=r(865),f=r(9922);let T=(()=>{class n{constructor(t){this.kitService=t}getScanInput(t){return new Promise((i,o)=>{this.kitService.getKitById(t).then(a=>{i(a)},()=>{o()})})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.e))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var S=r(5026),y=r(6733),C=r(134),_=r(1172);const M=["scanInput"],Z=["scanButton"];function w(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"(Drap)"),e.qZA())}function k(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"(Pol)"),e.qZA())}function D(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label",19),e._uU(2),e.YNc(3,w,2,0,"span",9),e.YNc(4,k,2,0,"span",9),e.qZA(),e.TgZ(5,"ion-label"),e._uU(6),e.qZA(),e.TgZ(7,"ion-label",29),e._uU(8),e.ALo(9,"date"),e.qZA(),e.TgZ(10,"ion-label",29),e._uU(11),e.ALo(12,"date"),e.qZA(),e.TgZ(13,"ion-label",29),e._uU(14),e.ALo(15,"date"),e.qZA(),e.TgZ(16,"ion-button",30),e.NdJ("click",function(){const a=e.CHM(t).index;return e.oxw(2).removeKit(a)}),e._UZ(17,"ion-icon",31),e.qZA(),e.qZA()}if(2&n){const t=s.$implicit,i=e.oxw(2);e.xp6(2),e.hij("",t.referenceSAP," "),e.xp6(1),e.Q6J("ngIf",t===i.molding.matDrap),e.xp6(1),e.Q6J("ngIf",t===i.molding.matPolym),e.xp6(2),e.Oqu(t.designationSAP),e.xp6(1),e.Q6J("color",i.kitService.isPerim(t.peremptionMoins18,i.molding.moldingDay)?"danger":"dark"),e.xp6(1),e.Oqu(e.xi3(9,10,t.peremptionMoins18,"dd/MM/yyyy \xe0 HH:mm")),e.xp6(2),e.Q6J("color",i.kitService.isPerim(t.aDrapAv,i.molding.moldingDay)?"danger":"dark"),e.xp6(1),e.Oqu(e.xi3(12,13,t.aDrapAv,"dd/MM/yyyy \xe0 HH:mm")),e.xp6(2),e.Q6J("color",i.kitService.isPerim(t.aCuirAv,i.molding.moldingDay)?"danger":"dark"),e.xp6(1),e.Oqu(e.xi3(15,16,t.aCuirAv,"dd/MM/yyyy \xe0 HH:mm"))}}function U(n,s){if(1&n&&(e.TgZ(0,"ion-list"),e.TgZ(1,"ion-item"),e.TgZ(2,"ion-label",19),e._uU(3,"R\xe9f\xe9rence Sap"),e.qZA(),e.TgZ(4,"ion-label"),e._uU(5,"D\xe9signation"),e.qZA(),e.TgZ(6,"ion-label"),e._uU(7,"P\xe9remption \xe0 -18\xb0C"),e.qZA(),e.TgZ(8,"ion-label"),e._uU(9,"A draper avant le"),e.qZA(),e.TgZ(10,"ion-label"),e._uU(11,"A cuire avant le"),e.qZA(),e.qZA(),e.YNc(12,D,18,19,"ion-item",28),e.qZA()),2&n){const t=e.oxw();e.xp6(12),e.Q6J("ngForOf",t.molding.kits)}}const E=[{path:"",component:(()=>{class n{constructor(t,i,o,a,c,u,h,p,z,B,R){this.scanService=t,this.moldingService=i,this.moldingToolService=o,this.alertController=a,this.kitService=c,this.router=u,this.navCtrl=h,this.loadingController=p,this.activatedRoute=z,this.toastController=B,this.authService=R,this.molding={id:null,kits:[],moldingDay:new Date,outillage:null,moldingUser:null};const b=this.activatedRoute.snapshot.paramMap.get("id");b?(this.pageTitle="Modification moulage",this.loadMoldingData(b)):this.pageTitle="Nouveau moulage"}loadMoldingData(t){return(0,d.mG)(this,void 0,void 0,function*(){const i=yield this.loadingController.create({cssClass:"my-custom-class",message:"Patienter pendant le chargement du moulage"});this.moldingService.getMoldingById(t).then(o=>{this.molding=o,this.moldingService.updateDates(this.molding),this.molding.updatedAt=new Date,console.log(this.molding),i.dismiss()})})}ngAfterViewInit(){this.scanButtonText="SCAN INACTIF",this.scanButton.color="danger",this.scanService.scanState=!1}ngOnInit(){}associateToolClick(){this.associateToolAlertPrompt()}associateToolAlertPrompt(){return(0,d.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Associer l'outillage de moulage",inputs:[{name:"toolNumber",type:"text",placeholder:"Scannez l'outillage",tabindex:1,id:"toolNumberInput"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"ion-color-secondary",handler:i=>{console.log("Confirm Cancel",i)}},{text:"Valider",cssClass:["ion-color-primary","button","button-solid"],handler:i=>{this.setLinkedTool(i.toolNumber)}}]})).present().then(()=>{const i=document.getElementById("toolNumberInput");i&&i.focus()})})}setLinkedTool(t){console.log(t),this.moldingToolService.getToolByToolNumber(t).then(i=>{this.molding.outillage=i,this.presentToast("Outillage associ\xe9 !")})}switchScanState(){this.scanService.scanState=!this.scanService.scanState,this.scanService.scanState&&this.scanInput.setFocus()}inputOnBlur(){this.scanButton.color="danger",this.scanButtonText="SCAN INACTIF",this.scanService.scanState=!1}inputOnFocus(){this.scanButton.color="success",this.scanButtonText="SCAN ACTIF",this.scanService.scanState=!0}scanInputAction(){return(0,d.mG)(this,void 0,void 0,function*(){const t=yield this.loadingController.create({cssClass:"my-custom-class",message:"Patienter pendant le chargement du kit"});yield t.present(),this.scanService.getScanInput(this.scanInput.value.toString()).then(a=>{this.kitService.kitIsInKits(a,this.molding.kits)?(this.presentToast("Le kit a d\xe9j\xe0 \xe9t\xe9 scann\xe9"),console.log("kit en doublon")):(this.molding.kits.push(a),this.moldingService.updateDates(this.molding),this.presentToast("Kit ajout\xe9 !"))}).catch(()=>{this.wrongKitInputAlert(),console.error("Le kit scann\xe9 ne semble pas \xeatre un kit")}).finally(()=>{this.scanInput.value="",t.dismiss()}),yield t.onDidDismiss()})}removeKit(t){try{this.molding.kits.splice(t,1),console.log(`Kit removed ${t}`),this.moldingService.updateDates(this.molding)}catch(i){console.error(i)}}saveMoldingClick(){this.saveMolding().then(()=>{console.log("Kit sauvegard\xe9. Voulez-vous imprimer ?"),this.presentAlertConfirm()},()=>{this.saveMoldingErrorAlert()})}saveMolding(){return new Promise((t,i)=>{this.checkMoldingDatas().then(o=>{console.log("le moulage \xe0 le statut : ",o),o?(this.molding.moldingUser=this.authService.authUser,null===this.molding.id?this.moldingService.saveMolding(this.moldingService.toIri(this.molding)).then(a=>{this.molding=this.moldingService.moldingServerToMoldingObject(a),console.log("tout est OK le moulage est sauvegard\xe9",this.molding),t()},()=>{console.log("tout n'est pas Ok la sauvegarde a \xe9chou\xe9e"),i()}):this.moldingService.updateMolding(this.moldingService.toIri(this.molding)).then(a=>{this.molding=a,console.log("tout est OK le moulage est mis \xe0 jour"),t()},()=>{console.error("tout n'est pas Ok la mise \xe0 jour du moulage a \xe9chou\xe9e"),i()})):(console.error("sauvegarde abandonn\xe9e"),i())})})}checkMoldingDatas(){return new Promise((t,i)=>{null===this.molding.outillage?(console.log("le moulage n'a pas d'outillage associ\xe9. Voulez-vous continuer sans outillage ?"),this.presentAlertToolMissing().then(o=>{o?(console.log("onResolve : Je veux continuer sans outillage",o),t(!0)):(console.log("onResolve : Je ne veux pas continuer sans outillage",o),t(!1))},o=>{const a="Les donn\xe9es nont pas pu \xeatre contr\xf4l\xe9es. OU Il n'y a pas eu de r\xe9ponse de l'utilisateur";console.log(a,o),i(a)})):0===this.molding.kits.length?(console.log("onResolve : Il n'y a pas de kit"),t(!1)):t(!0)})}presentAlertConfirm(){return(0,d.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Enregistrement effectu\xe9",message:"Voulez-vous imprimer la fiche ?",buttons:[{text:"Non",role:"cancel",cssClass:["ion-color-primary","ion-button"],id:"cancel-button",handler:()=>{console.log("Confirm Cancel: blah")}},{text:"Oui",id:"confirm-button",cssClass:"ion-color-danger",handler:()=>{this.printMolding()}}]})).present()})}presentAlertToolMissing(){return new Promise((t,i)=>{this.alertController.create({cssClass:"my-custom-class",header:"Alerte",message:"L'outillage de moulage n'est pas associ\xe9. voulez-vous continuer sans outillage ?",buttons:[{text:"Non",role:"cancel",cssClass:["ion-color-primary","ion-button"],id:"cancel-button",handler:()=>{console.log("Response false"),t(!1)}},{text:"Oui",id:"confirm-button",cssClass:"ion-color-danger",handler:()=>{console.log("Response true"),t(!0)}}]}).then(o=>{o.present()})})}printMolding(){console.log(this.molding),this.router.navigate(["/printMolding",this.molding.id])}printMoldingClick(){this.saveMolding().then(()=>{this.printMolding()})}wrongKitInputAlert(){return(0,d.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Erreur Kit",subHeader:"Kit non conforme",message:"Il semble y avoir un probl\xe8me avec le kit scann\xe9. V\xe9rifier le kit et essayer de nouveau.",buttons:["OK"]});yield t.present(),yield t.onDidDismiss()})}saveMoldingErrorAlert(){return(0,d.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Erreur de sauvegarde",subHeader:"Le moulage n'a pas \xe9t\xe9 sauvegard\xe9",message:"Veuillez r\xe9-essayer",buttons:["OK"]});yield t.present(),yield t.onDidDismiss()})}presentToast(t){return(0,d.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:t,duration:2e3,position:"bottom",translucent:!0,animated:!0})).present()})}kitAlertPrompt(){return(0,d.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:"Scannez un kit",inputs:[{name:"kitnumber",type:"text",placeholder:"Scannez le kit",tabindex:1,id:"kitNumberInput"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"ion-color-secondary",handler:i=>{console.log("Confirm Cancel",i)}},{text:"Valider",cssClass:["ion-color-primary","button","button-solid"],handler:i=>{this.scanInputAction()}}]})).present().then(()=>{const i=document.getElementById("toolNumberInput");i&&i.focus()})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T),e.Y36(S.s),e.Y36(y.n),e.Y36(l.Br),e.Y36(f.e),e.Y36(m.F0),e.Y36(l.SH),e.Y36(l.HT),e.Y36(m.gz),e.Y36(l.yF),e.Y36(C.e))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-molding"]],viewQuery:function(t,i){if(1&t&&(e.Gf(M,5),e.Gf(Z,5)),2&t){let o;e.iGM(o=e.CRH())&&(i.scanInput=o.first),e.iGM(o=e.CRH())&&(i.scanButton=o.first)}},decls:51,vars:12,consts:[[3,"page"],["color","light",1,"ion-hide-md-down"],["slot","start","collapse","true"],["fill","solid","size","default",3,"click"],["scanButton",""],["lines","true","type","text","placeholder","Id du kit",3,"change","focusout","focusin"],["scanInput",""],["fill","clear","size","default",3,"click"],["slot","start","name","link-outline"],[4,"ngIf"],["slot","bottom",1,"ion-hide-md-up"],["tab","schedule"],["name","link"],["tab","speakers",3,"click"],["name","scan"],["tab","map"],["name","print"],["tab","about",3,"click"],["name","save"],[1,"ion-hide-md-down"],[1,"ion-space-between"],["lines","none"],["color","light"],["slot","end","collapse","true"],["slot","end","fill","clear",3,"click"],["slot","start","name","save-outline"],["slot","end","fill","solid","color","primary",3,"click"],["slot","start","name","print-outline"],[4,"ngFor","ngForOf"],[3,"color"],[1,"ion-hide-md-down",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(t,i){1&t&&(e._UZ(0,"app-shared-user-header",0),e.TgZ(1,"ion-content"),e.TgZ(2,"ion-toolbar",1),e.TgZ(3,"ion-buttons",2),e.TgZ(4,"ion-button",3,4),e.NdJ("click",function(){return i.switchScanState()}),e._uU(6),e.qZA(),e.TgZ(7,"ion-input",5,6),e.NdJ("change",function(){return i.scanInputAction()})("focusout",function(){return i.inputOnBlur()})("focusin",function(){return i.inputOnFocus()}),e.qZA(),e.TgZ(9,"ion-button",7),e.NdJ("click",function(){return i.associateToolClick()}),e._UZ(10,"ion-icon",8),e._uU(11," OUTILLAGE "),e.qZA(),e.qZA(),e.qZA(),e.YNc(12,U,13,1,"ion-list",9),e.qZA(),e.TgZ(13,"ion-tab-bar",10),e.TgZ(14,"ion-tab-button",11),e._UZ(15,"ion-icon",12),e.TgZ(16,"ion-label"),e._uU(17,"Outillage"),e.qZA(),e.TgZ(18,"ion-badge"),e._uU(19,"6"),e.qZA(),e.qZA(),e.TgZ(20,"ion-tab-button",13),e.NdJ("click",function(){return i.kitAlertPrompt()}),e._UZ(21,"ion-icon",14),e.TgZ(22,"ion-label"),e._uU(23,"Scan kit"),e.qZA(),e.qZA(),e.TgZ(24,"ion-tab-button",15),e._UZ(25,"ion-icon",16),e.TgZ(26,"ion-label"),e._uU(27,"Imprimer"),e.qZA(),e.qZA(),e.TgZ(28,"ion-tab-button",17),e.NdJ("click",function(){return i.saveMoldingClick()}),e._UZ(29,"ion-icon",18),e.TgZ(30,"ion-label"),e._uU(31,"Sauvegarder"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(32,"ion-footer",19),e.TgZ(33,"ion-toolbar",20),e.TgZ(34,"ion-item",21),e.TgZ(35,"ion-label"),e._uU(36),e.qZA(),e.TgZ(37,"ion-label"),e._uU(38),e.ALo(39,"date"),e.qZA(),e.TgZ(40,"ion-label"),e._uU(41),e.ALo(42,"date"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(43,"ion-toolbar",22),e.TgZ(44,"ion-buttons",23),e.TgZ(45,"ion-button",24),e.NdJ("click",function(){return i.saveMoldingClick()}),e._UZ(46,"ion-icon",25),e._uU(47," SAUVEGARDER "),e.qZA(),e.TgZ(48,"ion-button",26),e.NdJ("click",function(){return i.printMoldingClick()}),e._UZ(49,"ion-icon",27),e._uU(50," IMPRIMER "),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.Q6J("page",i.pageTitle),e.xp6(6),e.hij(" ",i.scanButtonText," "),e.xp6(6),e.Q6J("ngIf",null==i.molding?null:i.molding.kits),e.xp6(24),e.hij("Outillage : ",null==i.molding||null==i.molding.outillage?null:i.molding.outillage.sapToolNumber,""),e.xp6(2),e.hij("A draper avant le : ",e.xi3(39,6,null==i.molding?null:i.molding.aDraperAv,"dd/MM/yyyy \xe0 HH:mm"),""),e.xp6(3),e.hij("A cuire avant le : ",e.xi3(42,9,null==i.molding?null:i.molding.aCuireAv,"dd/MM/yyyy \xe0 HH:mm"),""))},directives:[_.Q,l.W2,l.sr,l.Sm,l.YG,l.pK,l.j9,l.gu,g.O5,l.yq,l.ZU,l.Q$,l.yp,l.fr,l.Ie,l.q_,g.sg],pipes:[g.uU],styles:[""]}),n})()},{path:"print-molding-sheet",loadChildren:()=>r.e(8152).then(r.bind(r,8152)).then(n=>n.PrintMoldingSheetPageModule)}];let P=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[m.Bz.forChild(E)],m.Bz]}),n})(),J=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.ez]]}),n})();var q=r(9372);let Q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.ez,I.u5,l.Pc,P,q.A,J]]}),n})()}}]);