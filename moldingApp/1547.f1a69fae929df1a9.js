"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1547,6188],{8190:(R,A,l)=>{l.d(A,{b:()=>m});var e=l(4762),c=l(3668),p=l(1704);let m=(()=>{class u{constructor(_){this.loadingController=_}startLoading(_){this.loadingController.create({cssClass:"my-custom-class",message:_}).then(S=>{S.present()})}stopLoading(){return(0,e.mG)(this,void 0,void 0,function*(){setTimeout(()=>{this.loadingController.dismiss()},100)})}}return u.\u0275fac=function(_){return new(_||u)(c.LFG(p.HT))},u.\u0275prov=c.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},3580:(R,A,l)=>{l.d(A,{C:()=>S});var e=l(4762),c=l(8260),p=l(3668),m=l(3521),u=l(6188),v=l(2048),_=l(6607);let S=(()=>{class s{constructor(t,i,d,P){this.requestService=t,this.toolService=i,this.userService=d,this.authService=P}getType(t){return"string"==typeof t?t:t.controle?"controle":t.maintenance?"maintenance":void 0}createToolRequest(t){return this.requestService.createPostRequest(c.N.toolApi+"demandes",t)}createControlRequest(t){var i;const d={id:null!==(i=t.id)&&void 0!==i?i:null,outillage:t.outillage?this.toolService.getIri(t.outillage):"",dateBesoin:t.dateBesoin,userCreat:this.userService.getIri(this.authService.authUser),refPlan:t.refPlan,indPlan:t.indPlan,cheminCAO:t.cheminCAO,description:t.description,detailsControle:t.detailsControle,tolerances:t.tolerances,dispoOut:t.dispoOut,ligneBudgetaire:t.ligneBudgetaire,typeRapport:t.typeRapport};return this.requestService.createPostRequest(c.N.toolApi+"controles",d)}createAllMaintenaceItems(t){const i=[];return new Promise((d,P)=>{t.itemActionCorrective.forEach(T=>{this.requestService.createPostRequest(c.N.toolApi+"maintenance_items",T).then(q=>{i.push(`/api/maintenance_items/${q.id}`),console.log(i.length,t.itemActionCorrective.length),i.length===t.itemActionCorrective.length&&d(i)})})})}createMaintenanceRequest(t){return new Promise((i,d)=>{this.createAllMaintenaceItems(t).then(P=>{var T;console.log(P);const q={id:null!==(T=t.id)&&void 0!==T?T:null,outillage:t.outillage?this.toolService.getIri(t.outillage):"",dateBesoin:t.dateBesoin,userCreat:this.userService.getIri(this.authService.authUser),rep:t.rep,itemActionCorrective:P};console.log(q),this.requestService.createPostRequest(c.N.toolApi+"maintenances",q).then(x=>{i(x)})})})}updateRequest(t){const i={statut:t.statut,createdAt:t.createdAt,id:t.id};return this.requestService.createPutRequest(c.N.toolApi+"demandes/"+i.id,i)}updateControlRequest(t){var i;const d={id:null!==(i=t.controle.id)&&void 0!==i?i:null,outillage:t.controle.outillage?this.toolService.getIri(t.controle.outillage):"",dateBesoin:t.dateBesoin,userCreat:this.userService.getIri(t.controle.demandeur),refPlan:t.controle.refPlan,indPlan:t.controle.indPlan,cheminCAO:t.controle.cheminCAO,description:t.controle.description,detailsControle:t.controle.detailsControle,tolerances:t.controle.tolerances,dispoOut:t.controle.dispoOut,ligneBudgetaire:t.controle.ligneBudgetaire,interventionDate:t.controle.interventionDate,moyenMesure:t.controle.moyenMesure,infosComplementaire:t.controle.infosComplementaire,visaControleur:t.controle.visaControleur,typeRapport:t.controle.typeRapport};return console.log(d),this.requestService.createPutRequest(c.N.toolApi+"controles/"+d.id,d)}updateMaintenanceItems(t){return(0,e.mG)(this,void 0,void 0,function*(){const i=t.map(d=>d.id?this.requestService.createPutRequest(c.N.toolApi+"maintenance_items/"+d.id,d):this.requestService.createPostRequest(c.N.toolApi+"maintenance_items",d));return Promise.all(i)})}updateMainteanceRequest(t){return new Promise((i,d)=>{this.updateMaintenanceItems(t.maintenance.itemActionCorrective).then(P=>{var T;t.maintenance.itemActionCorrective=P,console.log(t.maintenance.itemActionCorrective);const q=t.maintenance.itemActionCorrective.map(y=>"/api/maintenance_items/"+y.id),x={id:null!==(T=t.maintenance.id)&&void 0!==T?T:null,outillage:t.maintenance.outillage?this.toolService.getIri(t.maintenance.outillage):"",dateBesoin:t.dateBesoin,userCreat:this.userService.getIri(t.maintenance.userCreat),itemActionCorrective:q};console.log(x),i(this.requestService.createPutRequest(c.N.toolApi+"maintenances/"+x.id,x))})})}getToolRequest(t){return this.requestService.createGetRequest(c.N.toolApi+"demandes/"+t)}getToolRequests(){return this.requestService.createGetRequest(c.N.toolApi+"demandes")}getControl(t){return this.requestService.createGetRequest(c.N.toolApi+"controles/"+t)}getMaintenance(t){return this.requestService.createGetRequest(c.N.toolApi+"maintenances/"+t)}}return s.\u0275fac=function(t){return new(t||s)(p.LFG(m.s),p.LFG(u.o),p.LFG(v.f),p.LFG(_.e))},s.\u0275prov=p.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},6188:(R,A,l)=>{l.d(A,{o:()=>v});var e=l(4522),c=l(8260),p=l(3668),m=l(3521),u=l(5243);let v=(()=>{class _{constructor(s,g,t){this.http=s,this.requestService=g,this.alertService=t}getToolByInput(s){return new Promise((g,t)=>{switch(s.length){case 5:this.getToolByToolNumber(s).then(i=>{g(i)},i=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",i),t()}).catch(i=>{console.error(i)});break;case 7:break;case 8:s.startsWith("OT")&&this.getToolByToolNumber(s.substring(s.length-5)).then(i=>{g(i)},i=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",i),t()}).catch(i=>{console.error(i)});break;default:this.getToolByIdentification(s).then(i=>{g(i)},i=>{this.alertService.simpleAlert("Erreur","Le serveur outillage \xe0 renvoy\xe9 une erreur :",i),t()}).catch(i=>{console.error(i)})}})}getToolById(s){return this.requestService.createGetRequest(`${c.N.toolApi}tools/${s}`)}getToolByToolNumber(s){return new Promise((g,t)=>{this.requestService.createGetRequest(`${c.N.toolApi}tools?sapToolNumber=${s}`).then(i=>{1===i.length?g(i[0]):t(i.length>1?"Il y a plus d'un outillage correspondant en base de donn\xe9e":"aucun outillage trouv\xe9")},i=>{console.log(i),t("Pas de r\xe9ponse du serveur")})})}getToolByIdentification(s){return new Promise((g,t)=>{this.requestService.createGetRequest(`${c.N.toolApi}tools?identification=${s}`).then(i=>{1===i.length?g(i[0]):t(i.length>1?"Il y a plus d'un outillage correspondant en base de donn\xe9e":"aucun outillage trouv\xe9")},i=>{console.log(i),t("Pas de r\xe9ponse du serveur")})})}getAllTools(){return new Promise((s,g)=>{const t=(new e.WM).append("content-type","application/json");this.http.get(`${c.N.apiServer}molding_tools`,{headers:t}).subscribe(i=>{s(i)},i=>{console.log(i),g()})})}getIri(s){return`/api/tools/${s.id}`}createTool(s){const g=s;return g.sapToolNumber=parseInt(s.sapToolNumber.substring(2),10),this.requestService.createPostRequest(c.N.toolApi+"tools",g)}}return _.\u0275fac=function(s){return new(s||_)(p.LFG(e.eN),p.LFG(m.s),p.LFG(u.c))},_.\u0275prov=p.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},1547:(R,A,l)=>{l.r(A),l.d(A,{ToolRequestsPageModule:()=>X});var e=l(3668),c=l(6019),p=l(9133),m=l(2899),u=l(1704),v=l(3050),_=l(3935),S=l(4762),s=l(3580),g=l(5243),t=l(8190);function i(o,r){if(1&o&&(e.TgZ(0,"ion-select-option",24),e._uU(1),e.qZA()),2&o){const n=r.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function d(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-select",22),e.NdJ("ionChange",function(f){const Z=e.CHM(n).$implicit;return e.oxw().filterChange(Z,f)}),e.YNc(4,i,2,2,"ion-select-option",23),e.qZA(),e.qZA()}if(2&o){const n=r.$implicit;e.xp6(2),e.Oqu(n.name),e.xp6(1),e.Q6J("placeholder","Filtre "+n.name),e.xp6(1),e.Q6J("ngForOf",n.options)}}function P(o,r){1&o&&(e.TgZ(0,"th",25),e._uU(1," Statut "),e.qZA())}function T(o,r){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const n=r.$implicit,a=e.oxw();e.Udp("border-left",a.getBorder(n)),e.xp6(1),e.hij(" ",n.statut,"")}}function q(o,r){1&o&&(e.TgZ(0,"th",25),e._uU(1," Num\xe9ro "),e.qZA())}function x(o,r){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const n=r.$implicit;e.xp6(1),e.hij(" ",n.id," ")}}function y(o,r){1&o&&(e.TgZ(0,"th",25),e._uU(1," Outillage "),e.qZA())}function D(o,r){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&o){const n=e.oxw().$implicit;e.xp6(1),e.AsE("OT",n.controle.outillage.sapToolNumber," - ",n.controle.outillage.designation,"")}}function O(o,r){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&o){const n=e.oxw().$implicit;e.xp6(1),e.AsE("OT",n.maintenance.outillage.sapToolNumber," - ",n.maintenance.outillage.designation,"")}}function N(o,r){if(1&o&&(e.TgZ(0,"td",26),e.YNc(1,D,2,2,"ion-label",27),e.YNc(2,O,2,2,"ion-label",27),e.qZA()),2&o){const n=r.$implicit;e.xp6(1),e.Q6J("ngIf",n.controle),e.xp6(1),e.Q6J("ngIf",n.maintenance)}}function E(o,r){1&o&&(e.TgZ(0,"th",28),e._uU(1," Date demande "),e.qZA())}function I(o,r){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const n=r.$implicit;e.xp6(1),e.hij(" ",e.Dn7(2,1,n.createdAt,"EE dd MMM yyyy","local")," ")}}function b(o,r){1&o&&(e.TgZ(0,"th",25),e._uU(1," Demandeur "),e.qZA())}function B(o,r){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&o){const n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.controle.demandeur.username)}}function L(o,r){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&o){const n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.maintenance.demandeur.username)}}function F(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"td",29),e.NdJ("click",function(){return e.CHM(n),e.oxw().userClick()}),e.YNc(1,B,2,1,"ion-label",27),e.YNc(2,L,2,1,"ion-label",27),e.qZA()}if(2&o){const n=r.$implicit;e.xp6(1),e.Q6J("ngIf",n.controle),e.xp6(1),e.Q6J("ngIf",n.maintenance)}}function Y(o,r){1&o&&(e.TgZ(0,"th",28),e._uU(1," Date Besoin "),e.qZA())}function w(o,r){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const n=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.Dn7(2,1,n.controle.dateBesoin,"dd MMMM yyyy","local"),"")}}function $(o,r){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const n=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.Dn7(2,1,n.maintenance.dateBesoin,"dd MMMM yyyy","local"),"")}}function Q(o,r){if(1&o&&(e.TgZ(0,"td",26),e.YNc(1,w,3,5,"ion-label",27),e.YNc(2,$,3,5,"ion-label",27),e.qZA()),2&o){const n=r.$implicit;e.xp6(1),e.Q6J("ngIf",n.controle),e.xp6(1),e.Q6J("ngIf",n.maintenance)}}function J(o,r){1&o&&e._UZ(0,"th",25)}function G(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"ion-button",31),e.NdJ("click",function(){e.CHM(n);const f=e.oxw().$implicit;return e.oxw().openControlClick(f)}),e._uU(1," Ouvrir "),e.qZA()}}function U(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"ion-button",31),e.NdJ("click",function(){e.CHM(n);const f=e.oxw().$implicit;return e.oxw().openMaintenanceClick(f)}),e._uU(1," Ouvrir "),e.qZA()}}function W(o,r){if(1&o&&(e.TgZ(0,"td",26),e.YNc(1,G,2,0,"ion-button",30),e.YNc(2,U,2,0,"ion-button",30),e.qZA()),2&o){const n=r.$implicit;e.xp6(1),e.Q6J("ngIf",n.controle),e.xp6(1),e.Q6J("ngIf",n.maintenance)}}function K(o,r){1&o&&e._UZ(0,"tr",32)}function j(o,r){1&o&&e._UZ(0,"tr",33)}const H=[{path:"",component:(()=>{class o{constructor(n,a,f,h){this.toolRequestService=n,this.alertControleService=a,this.navCtrl=f,this.loaderService=h,this.displayedRequestColumns=["statut","id","tool","createdAt","userCreat","needDate","buttons"],this.tableRequestsDataSource=new m.by,this.filterSelectObjects=[],this.filterValues={},this.filterSelectObjects=[{name:"Statut",columnProp:"statut",options:[]},{name:"Type de demande",columnProp:"type",options:[]}]}ionViewWillEnter(){this.updateRequestList()}ngOnInit(){this.tableRequestsDataSource.filterPredicate=this.createFilter()}createFilter(){return(a,f)=>{console.log(a,f);const h=JSON.parse(f);console.log(h);let Z=!1;for(const C in h)C&&(console.log(C),""!==h[C].toString()?Z=!0:delete h[C]);let M=!1;if(Z){for(const C in h)C&&h[C].trim().toLowerCase().split(" ").forEach(ee=>{-1!==a[C].toString().toLowerCase().indexOf(ee)&&Z&&(M=!0)});return M}return!0}}resetFilters(){this.filterValues={},this.filterSelectObjects.forEach((n,a)=>{n.modelValue=void 0}),this.tableRequestsDataSource.filter=""}getFilterObject(n,a){console.log(n,a);const f=[];return n.filter(h=>(f.includes(h[a])||f.push(h[a]),h)),f}updateRequestList(){return(0,S.mG)(this,void 0,void 0,function*(){this.loaderService.startLoading("Pateinter pendant le chargement des demandes"),this.toolRequestService.getToolRequests().then(n=>{this.tableRequestsDataSource.data=n,this.filterSelectObjects.filter(a=>{console.log(a),a.options=this.getFilterObject(this.tableRequestsDataSource.data,a.columnProp)})}).catch(n=>{console.error(n),this.alertControleService.simpleAlert("Erreur","Mise \xe0 jour de la liste","La liste des requ\xeates ne s'est pas mise \xe0 jour correctement ")}).finally(()=>{this.loaderService.stopLoading()})})}userClick(){}openControlClick(n){this.navCtrl.navigateForward("tooling/3D-tool/"+n.id)}openMaintenanceClick(n){this.navCtrl.navigateForward("tooling/repair-tool/"+n.id)}getBorder(n){return"controle"===this.toolRequestService.getType(n)?"4px lawngreen solid":"maintenance"===this.toolRequestService.getType(n)?"4px yellow solid":void 0}filterChange(n,a){console.log(n,a),this.filterValues[n.columnProp]=a.target.value.trim(),console.log(this.filterValues[n.columnProp]),console.log(JSON.stringify(this.filterValues)),this.tableRequestsDataSource.filter=JSON.stringify(this.filterValues)}filterRequestTypeChanged(n){this.tableRequestsDataSource.filter=n.target.value.trim().toLowerCase(),console.log(n)}filterRequestStatusChanged(n){this.tableRequestsDataSource.filter=n.target.value.trim().toLowerCase(),console.log(n)}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(s.C),e.Y36(g.c),e.Y36(u.SH),e.Y36(t.b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tool-requests"]],decls:41,vars:5,consts:[["color","dark"],["multi","",1,"example-headers-align"],["togglePosition","before"],["slot","start","name","filter-outline"],[4,"ngFor","ngForOf"],[1,"table","ion-justify-content-center","ion-align-items-center"],["mat-table","","fixedLayout","true","matSort","","matSortActive","needDate",1,"mat-elevation-z8",3,"dataSource"],["table",""],["matColumnDef","statut"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"border-left",4,"matCellDef"],["matColumnDef","id"],["mat-cell","",4,"matCellDef"],["matColumnDef","tool"],["matColumnDef","createdAt"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","userCreat"],["mat-cell","",3,"click",4,"matCellDef"],["matColumnDef","needDate"],["matColumnDef","buttons"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["multiple","false",3,"placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mat-header-cell",""],["mat-cell",""],[4,"ngIf"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",3,"click"],[3,"click",4,"ngIf"],[3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,a){1&n&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar",0),e.TgZ(2,"ion-title"),e._uU(3,"Liste des demandes"),e.qZA(),e.qZA(),e.TgZ(4,"ion-toolbar"),e.TgZ(5,"mat-accordion",1),e.TgZ(6,"mat-expansion-panel",2),e.TgZ(7,"mat-expansion-panel-header"),e.TgZ(8,"mat-panel-title"),e._UZ(9,"ion-icon",3),e._uU(10," Filtres "),e.qZA(),e._UZ(11,"mat-panel-description"),e.qZA(),e.TgZ(12,"ion-toolbar"),e.YNc(13,d,5,3,"ion-item",4),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"ion-content"),e.TgZ(15,"div",5),e.TgZ(16,"table",6,7),e.ynx(18,8),e.YNc(19,P,2,0,"th",9),e.YNc(20,T,2,3,"td",10),e.BQk(),e.ynx(21,11),e.YNc(22,q,2,0,"th",9),e.YNc(23,x,2,1,"td",12),e.BQk(),e.ynx(24,13),e.YNc(25,y,2,0,"th",9),e.YNc(26,N,3,2,"td",12),e.BQk(),e.ynx(27,14),e.YNc(28,E,2,0,"th",15),e.YNc(29,I,3,5,"td",12),e.BQk(),e.ynx(30,16),e.YNc(31,b,2,0,"th",9),e.YNc(32,F,3,2,"td",17),e.BQk(),e.ynx(33,18),e.YNc(34,Y,2,0,"th",15),e.YNc(35,Q,3,2,"td",12),e.BQk(),e.ynx(36,19),e.YNc(37,J,1,0,"th",9),e.YNc(38,W,3,2,"td",12),e.BQk(),e.YNc(39,K,1,0,"tr",20),e.YNc(40,j,1,0,"tr",21),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(13),e.Q6J("ngForOf",a.filterSelectObjects),e.xp6(3),e.Q6J("dataSource",a.tableRequestsDataSource),e.xp6(23),e.Q6J("matHeaderRowDef",a.displayedRequestColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",a.displayedRequestColumns))},directives:[u.Gu,u.sr,u.wd,v.pp,v.ib,v.yz,v.yK,u.gu,v.u4,c.sg,u.W2,m.BZ,m.w1,m.fO,m.Dz,m.as,m.nj,u.Ie,u.Q$,u.t9,u.QI,u.n0,m.ge,m.ev,c.O5,u.YG,m.XQ,m.Gk],pipes:[c.uU],styles:[".mat-row[_ngcontent-%COMP%]{height:auto}.mat-cell[_ngcontent-%COMP%]{padding:8px 16px 8px 0}.table[_ngcontent-%COMP%]{display:flex;padding:14px}.mat-table[_ngcontent-%COMP%]{width:100%}"]}),o})()}];let k=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[_.Bz.forChild(H)],_.Bz]}),o})();var z=l(9372),V=l(9749);let X=(()=>{class o{constructor(){(0,c.qS)(V.Z)}}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[{provide:e.soG,useValue:"fr-FR"}],imports:[[c.ez,p.u5,u.Pc,k,z.A,m.p0,v.To]]}),o})()}}]);